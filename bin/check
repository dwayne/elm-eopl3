#!/usr/bin/env bash

#
# Usage: check
#

set -uo pipefail

project="${PROJECT_ROOT:?}"

run () {
  command=$*
  output=$($command 2>&1)
  error=$?
  if (( error )); then
    fail "$output" "$error"
  fi
}

fail () {
  echo "$1" >&2
  exit "$2"
}

check-scripts () {
  shellcheck --norc --shell bash "$project/bin/"*
  #
  # --no-rc = Don't look for .shellcheckrc files
  # --shell = Specify dialect (sh, bash, dash, ksh, busybox)
  #
}

run check-scripts
run format --validate
run elm-test
